FROM node:20-alpine

WORKDIR /app

# Copiar package files
COPY package*.json ./

# Instalar dependencias
RUN npm ci --only=production

# Copiar c√≥digo fuente necesario
COPY lib/ ./lib/
COPY scripts/ ./scripts/
COPY tsconfig.json ./

# Instalar ts-node para desarrollo
RUN npm install -g ts-node typescript

# Variables de entorno por defecto
ENV NODE_ENV=production
ENV REDIS_ENABLED=true

# Ejecutar workers
CMD ["npx", "ts-node", "scripts/run-workers.ts"]
